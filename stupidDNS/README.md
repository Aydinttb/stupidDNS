# stupidDNS

سرویس stupidDNS برای استفاده در سطح شبکه طراحی شده است و از طریق شبکه قابل دسترسی و استفاده است ،این سرویس بسیار مناسب شرایطی است که تعدادی نود دارید و میخواهید یکی از نود ها نقش local dns و nginx-proxy را داشته باشد و مراحل ستاپ آن به شرح زیر است

#### 1. نصب docker (در صورتی که در سیستم شما داکر نصب است این مرحله را نادیده بگیرید)
#### 2. دریافت پروژه
```bash
git clone https://github.com/Aydinttb/stupidDNS.git
cd stupidDNS/stupidDNS
```
#### 3. قراردادن آیپی سرور در فایل domains.conf
```bash
sed -i s/<YOUR_IP>/YOUR_SRV_IP/g
```
#### 4. اجرای کانتینر ها
```bash
sudo docker compose up -d
```
در صورتی که مراحل بالا به درستی به اتمام برسند ،سرور شما می تواند به عنوان dns ای مانند شکن در شبکه خدمات دهد 
همچنین در صورتی که نیاز دارید این سرویس مانند یک dns server local رکورد های مد نظر شما را ریزالو کند می توانید رکورد مد نظرتان را در فرمت زیر به فایل `dnsmasq/domains.conf` اضافه کنید
```
address=/your_domain/IP
### example
address=/compute01/192.168.1.1
address=/compute02/192.168.1.2
```

---
## راهنمای اضافه کردن دامنه 
برای تست این که آیا ترافیک به سمت دامنه مد نظر شما از این سرویس عبور می کند یا خیر می توانید دستور زیر را اجرا کنید 

```
dig +short <your_domain.com> @127.0.0.1
```
در صورتی که ایپی ریزالو شده آیپی سرور stupidDNS شما باشد به این معنی است که ترافیک شما به سمت این دامنه از سرویس stupidDNS عبور می کند ولی در صورتی که مقدار دیگری ریزالو شود یعنی ترافیک به سمت دامنه مقصد از اینترنت دیفالت سیستم عبور می کند

## اضافه کردن دامنه
در صورتی که دامنه مورد نظرتان از این سرویس عبور نمیکند ،میتوانید آنرا با فرمت زیر به فایل dnsmasq/domains.conf اضافه کنید و سپس کانتینر dnsmasq را ریستارت کنید
```bash
echo "address=/.<your_domain>/<your_IP>" >> dnsmasq/domains.conf
sudo docker restart dnsmasq-proxy
```
اگر دامنه به صورت `address=/.example.com/IP` اضافه شود به این معنی است که ترافیک خود دامنه و تمام زیر دامنه ها از پروکسی رد می شود ولی در صورتی که دامنه به صورت `address=/example.com/IP` اضافه شود فقط ترافیک دامنه `example.com` از پروکسی رد می شود و زیر دامنه های آن خیر

